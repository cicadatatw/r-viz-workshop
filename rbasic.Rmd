---
title: "rbasic"
author: "çŸ¥äº†æ–°èåœ˜éšŠ"
# date: "3/19/2017"
date: "`r Sys.Date()`"
output:
  ioslides_presentation:
    incremental: true
---

```{r setup 1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE )
```

## å›é ­ä¾†çœ‹ R åŸºç¤èªæ³• {.build}

- å‘é‡å¼çš„é‹ç®—
```{r vectorize}
c(1, 2, 3, 4) + 1
c(1, 2, 3, 4) + c(2, 3, 4, 5)
c(1, 2, 3, 4) + c(2, 10)
```
- ï¼…ï¼†ï¼ ï¼„ï¼¾ï¼Šï¼…ï¼ ï¼
- ã€Œé˜¿é¬¼ä½ é‚„æ˜¯èªªä¸­æ–‡å§ï¼ã€


## å›é ­ä¾†çœ‹ R åŸºç¤èªæ³• {.build}

*To understand computations in R, two slogans are helpful:*

- *Everything that exists is an object.*
- *Everything that happens is a function call."*

*â€” John Chambers*

<div class="columns-2">

```{r function call, warning=FALSE, message=FALSE}
`+`
`<-`
`[`
`c`
```

</div>

## å›é ­ä¾†çœ‹ R åŸºç¤èªæ³• {.build}

- ä»€éº¼æ˜¯ `function call`ï¼Ÿ
```{r function call 1}
1 + 1
`+`(1, 1)
```

## å›é ­ä¾†çœ‹ R åŸºç¤èªæ³• {.build}

- æ²’é—œä¿‚ä¸é‡è¦ï¼Œææ‡‚ `Dataframe` å°±å¥½
- ï¼ˆç›´ç¿»ï¼‰è³‡æ–™æ¡†ï¼Œå°±æ˜¯è¡¨æ ¼çš„æ„æ€å•¦
- çœ‹èµ·ä¾†å¤§æ¦‚å·®ä¸å¤šå°±æ˜¯é•·é€™ç¨®æ¨£å­ï¼ˆï¼Ÿï¼‰
```{r dataframe 0, echo=FALSE, warning=FALSE, message=FALSE}
# install.packages("Lahman")
library(Lahman)
library(dplyr)
```

```{r dataframe 1}
wang <- Pitching %>% filter(playerID == "wangch01") %>% arrange(desc(yearID))
wang
```

## æ–°æ½®å¥½ç”¨çš„ç©æ„å…’ R {.build}

- å¥½ç”¨å·¥å…·`æ‡¶äººåŒ…` ğŸ’ğŸ‘ğŸ‘›ğŸ‘œğŸ’¼ 
- [`tidyverse`](http://tidyverse.org/)

![](http://forcats.tidyverse.org/logo.png)
![](http://ggplot2.tidyverse.org/logo.png)
![](http://haven.tidyverse.org/logo.png)
![](http://readr.tidyverse.org/logo.png)
![](http://stringr.tidyverse.org/logo.png)
![](http://tidyr.tidyverse.org/logo.png)
```{r tidyverse}
# install.packages("tidyverse")
library(tidyverse)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `readr::read_csv()`
- è·ŸåŸç”Ÿæ–¹æ³•æ¯”èµ·ä¾†ï¼Œæ•ˆç‡è¼ƒé«˜ï¼Œä¹Ÿä¸æœƒå°‡æ–‡å­—æ ¼å¼è½‰æˆ `factor`ï¼ˆå› å­ï¼‰ä¾†è™•ç†
- æ¯” `data.table::fread()` ç•¥æ…¢ï¼Œä¸éèªæ³•è¼ƒç°¡å–®
```{r read_csv 0}
traffic <- read_csv("ggplot2-slides/traffic_eng.csv")
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `readr::read_csv()`
```{r read_csv 1}
head(traffic, n=3)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `readr::read_csv()`
```{r read_csv 2}
traffic <- read_csv("ggplot2-slides/traffic_eng.csv", col_types = 
                      cols(
                        time.year = col_integer(),
                        time.month = col_integer(),
                        time.day = col_integer(),
                        time.hour = col_integer(),
                        time.minute = col_integer(),
                        event.level = col_character(),
                        location.district = col_character(),
                        location.address = col_character(),
                        number.dead = col_integer(),
                        number.injury = col_integer(),
                        party.sn = col_integer(),
                        vehicle.type = col_character(),
                        party.gender = col_character(),
                        party.age = col_integer(),
                        party.injury = col_character(),
                        location.weather = col_character(),
                        location.speed.limit = col_integer(),
                        location.road.type = col_character(),
                        location.type = col_character()
                      ))
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `readr::read_csv()`
```{r read_csv 3}
head(traffic, n=3)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `dplyr::data_frame()`
- è·ŸåŸç”Ÿæ–¹æ³•æ¯”èµ·ä¾†ï¼Œæ•ˆç‡è¼ƒé«˜ï¼Œä¹Ÿä¸æœƒå°‡æ–‡å­—æ ¼å¼è½‰æˆ `factor`ï¼ˆå› å­ï¼‰ä¾†è™•ç†
- æ¯” `data.table::data.table()` ç•¥æ…¢ï¼Œä¸éèªæ³•è¼ƒç°¡å–®
```{r data_frame}
traffic <- data_frame(time.year = c(104), time.month = c(1), 
                      time.day = c(1), time.hour = c(0), 
                      time.minute = c(0, 1, 2), event.level = c("ä¸€èˆ¬"))
head(traffic, n=3)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `magrittr` (pipe `%>%`)
- æŠŠå·¥ä½œæµç¨‹çš„æ¯ä¸€ç«™`ä¸²æ¥`èµ·ä¾†ï¼Œç°¡åŒ–é–‹ç™¼é‚è¼¯è·Ÿç¨‹å¼ç¢¼
```{r pipe 0}
head(traffic, n=3)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `magrittr` (pipe `%>%`)
- æŠŠå·¥ä½œæµç¨‹çš„æ¯ä¸€ç«™`ä¸²æ¥`èµ·ä¾†ï¼Œç°¡åŒ–é–‹ç™¼é‚è¼¯è·Ÿç¨‹å¼ç¢¼
```{r pipe 1}
traffic %>% head(3)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `dplyr::select()`
```{r dplyr 0}
wang %>% select(yearID, teamID, W, L, ERA)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `dplyr::filter()`
```{r dplyr 1}
wang %>% filter(GS > 10)
```

## ç•«åœ–ä¹‹å‰å…ˆæŠŠè³‡æ–™è®€é€²ä¾† {.build}

- `dplyr::summarise()`
```{r dplyr 2}
wang %>% group_by(lgID) %>% summarise(mean(ERA))
```
